# Быстрая инструкция по деплою на Amvera Cloud

## Подготовка

1. Убедитесь, что у вас есть аккаунт на [Amvera Cloud](https://amvera.ru)
2. В проекте уже настроен файл `amvera.yaml` - он готов к использованию

## Шаг 1: Создание приложения в Amvera

1. Войдите в личный кабинет Amvera Cloud
2. Нажмите кнопку **«Создать приложение»**
3. Выберите способ деплоя: **Git репозиторий**
4. Укажите название приложения

## Шаг 2: Подключение Git репозитория

**Важно:** Вы можете использовать либо свой репозиторий (GitHub/GitLab/Bitbucket), либо репозиторий Amvera. 
Подробное сравнение смотрите в файле `AMVERA_REPOSITORY_GUIDE.md`.

### ⭐ Вариант A: Подключение своего репозитория (GitHub/GitLab/Bitbucket) - Рекомендуется

**Лучше всего, если у вас уже есть репозиторий на GitHub/GitLab/Bitbucket.**

1. В панели управления Amvera перейдите в **«Настройки» → «Репозиторий»**
2. Выберите **«Подключить внешний репозиторий»**
3. Авторизуйтесь через GitHub/GitLab/Bitbucket
4. Выберите ваш репозиторий и ветку (обычно `main` или `master`)
5. Готово! Теперь при каждом `git push` в ваш репозиторий Amvera автоматически задеплоит

**Преимущества:**
- ✅ Код в одном месте
- ✅ Используете привычный workflow
- ✅ Просто делаете `git push origin main` и все работает

### Вариант B: Репозиторий Amvera

**Используйте, если не хотите создавать репозиторий на GitHub.**

1. В панели управления приложением перейдите во вкладку **«Репозиторий»**
2. Скопируйте URL репозитория (например: `https://git.amvera.ru/username/project-name`)
3. В локальной папке проекта выполните:

```bash
# Добавьте remote репозиторий Amvera
git remote add amvera https://git.amvera.ru/username/project-name

# Отправьте код
git push amvera master
# или
git push amvera main
```

При запросе имени пользователя и пароля укажите данные вашей учетной записи Amvera.

## Шаг 3: Настройка переменных окружения

**Важно**: Все секретные ключи нужно установить в панели управления Amvera!

1. В панели управления приложением перейдите в **«Переменные окружения»**
2. Добавьте следующие переменные:

```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_supabase_anon_key
SUPABASE_SERVICE_KEY=your_supabase_service_role_key
JWT_SECRET=your-jwt-secret-here
JWT_REFRESH_SECRET=your-refresh-secret-key-here
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
TELEGRAM_WEBAPP_URL=https://your-app.amvera.app
TELEGRAM_ADMIN_CHAT_ID=your_admin_chat_id
DISABLE_REALTIME=false
NODE_ENV=production
```

**Примечание**: 
- `TELEGRAM_WEBAPP_URL` сначала укажите как `https://your-app.amvera.app` (замените `your-app` на имя вашего приложения)
- После успешного деплоя обновите этот URL на реальный адрес вашего приложения

## Шаг 4: Деплой

После настройки переменных окружения:

1. Если используете репозиторий Amvera - выполните `git push amvera master`
2. Если подключили внешний репозиторий - выполните `git push` в ваш основной репозиторий
3. Amvera автоматически начнет сборку и деплой

## Шаг 5: Проверка

1. Дождитесь завершения сборки (можно отслеживать в панели управления)
2. После успешного деплоя приложение будет доступно по адресу: `https://your-app.amvera.app`
3. Проверьте логи в панели управления, если что-то пошло не так
4. Обновите `TELEGRAM_WEBAPP_URL` на реальный URL вашего приложения в переменных окружения

## Настройка кастомного домена

1. В панели управления перейдите в **«Домены»**
2. Нажмите **«Добавить домен»**
3. Введите ваш домен
4. Настройте DNS записи согласно инструкциям Amvera:
   - Добавьте CNAME запись, указывающую на ваш домен Amvera
5. Дождитесь активации домена (обычно несколько минут)
6. Обновите `TELEGRAM_WEBAPP_URL` на ваш кастомный домен

## Автоматический деплой

Amvera автоматически деплоит приложение при каждом push в основную ветку (master/main).

Для ручного деплоя:
1. Перейдите в панель управления приложением
2. Нажмите **«Пересобрать»** или **«Деплой»**

## Обновление приложения

Просто выполните push в репозиторий:

```bash
git add .
git commit -m "Обновление приложения"
git push amvera master  # или git push, если используете внешний репозиторий
```

Amvera автоматически пересоберет и задеплоит новую версию.

## Troubleshooting

### Ошибка сборки

1. Проверьте логи сборки в панели управления Amvera
2. Убедитесь, что все зависимости указаны в `package.json`
3. Проверьте, что версия Node.js совпадает (в `amvera.yaml` указана версия 18)

### Приложение не запускается

1. Проверьте логи приложения в панели управления
2. Убедитесь, что все переменные окружения установлены
3. Проверьте, что `TELEGRAM_WEBAPP_URL` указывает на правильный адрес

### Проблемы с переменными окружения

1. Убедитесь, что все переменные добавлены в панели управления
2. После изменения переменных приложение автоматически перезапустится
3. Проверьте, что нет опечаток в названиях переменных

## Полезные ссылки

- [Документация Amvera Cloud](https://docs.amvera.ru/)
- [Поддержка Amvera](https://amvera.ru/support)

