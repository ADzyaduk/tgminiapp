# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ Telegram –±–æ—Ç–∞

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ö–Ω–æ–ø–∫–∏ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" –∏ "–û—Ç–º–µ–Ω–∏—Ç—å" –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö Telegram –±–æ—Ç–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –∫–∞–∫ –ø–æ–ª–æ–∂–µ–Ω–æ.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –¥–≤—É–º—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤

### –ë—ã–ª–æ:

1. **`/api/telegram/webhook.post.ts`** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ñ–æ—Ä–º–∞—Ç `confirm_regular_123`
2. **`/api/telegram/callback.post.ts`** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏–ª —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç –∫–∞–∫ `action:bookingId`

### –§–æ—Ä–º–∞—Ç –∫–Ω–æ–ø–æ–∫:

- ‚úÖ **–°–æ–∑–¥–∞–≤–∞–ª–∏—Å—å**: `confirm_regular_123`, `cancel_regular_123`, `confirm_group_trip_456`
- ‚ùå **–ü–∞—Ä—Å–∏–ª–∏—Å—å –≤ callback.post.ts**: `action:bookingId` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

- **–£–¥–∞–ª–µ–Ω**: `server/api/telegram/callback.post.ts`
- **–û—Å—Ç–∞–≤–ª–µ–Ω**: `server/api/telegram/webhook.post.ts` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π)

### 2. –£–ª—É—á—à–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (admin/manager)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ª–æ–¥–∫–æ–π
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã TypeScript –æ—à–∏–±–∫–∏

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã type assertions –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç–∏–ø–æ–≤

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**:

   - ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - ‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–π—Å—Ç–≤–∏—è

2. **–û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**:

   - ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ –î–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö –ø–æ–µ–∑–¥–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –º–µ—Å—Ç–∞
   - ‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
   - ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –∏ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
   - ‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –ª–æ–¥–∫–∞–º–∏

## üîß Webhook Configuration

**–¢–µ–∫—É—â–∏–π webhook URL**: `https://ciekuelurik.beget.app/api/telegram/webhook`

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìù –§–æ—Ä–º–∞—Ç callback_data

```typescript
// –û–±—ã—á–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
confirm_regular_123; // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ID 123
cancel_regular_456; // –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ID 456

// –ì—Ä—É–ø–ø–æ–≤—ã–µ –ø–æ–µ–∑–¥–∫–∏
confirm_group_trip_789; // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≥—Ä—É–ø–ø–æ–≤—É—é –ø–æ–µ–∑–¥–∫—É ID 789
cancel_group_trip_101; // –û—Ç–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø–æ–≤—É—é –ø–æ–µ–∑–¥–∫—É ID 101
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
curl -X POST "http://localhost:3000/api/telegram/test-buttons" \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "YOUR_TELEGRAM_ID",
    "booking_id": "123",
    "booking_type": "regular"
  }'
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **Webhook URL**: `/api/telegram/webhook-info`
2. **–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞**: –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback_query
3. **–ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: —Ä–æ–ª—å admin/manager –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. **–§–æ—Ä–º–∞—Ç callback_data**: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `action_type_id`
