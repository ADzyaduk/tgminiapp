# План оптимизации и улучшений проекта

## Объяснение JWT_REFRESH_SECRET

**JWT_REFRESH_SECRET** - это отдельный секретный ключ для подписи refresh токенов.

### Как это работает:
- **JWT_SECRET** - используется для подписи access токенов (живут 15 минут)
- **JWT_REFRESH_SECRET** - используется для подписи refresh токенов (живут 7 дней)

### Зачем нужен отдельный секрет?
1. **Безопасность** - если access токен скомпрометирован, refresh токен остается безопасным
2. **Гибкость** - можно отозвать все refresh токены, изменив только JWT_REFRESH_SECRET
3. **Лучшая практика** - разделение секретов для разных типов токенов

### Можно ли использовать один секрет?
Да, можно использовать тот же JWT_SECRET для обоих типов токенов, но это менее безопасно. В вашем проекте можно упростить, используя один секрет, если не требуется дополнительная безопасность.

## Найденные проблемы и улучшения

### 1. Дублирование кода
- Функция `generateTokens` дублируется в `server/api/telegram/auth.post.ts` и `server/api/telegram/check-auth.get.ts`
- **Решение**: Вынести в общий утилитный файл `server/utils/jwt.ts`

### 2. Устаревшие зависимости
- `@nuxt/ui`: 3.1.1 → 3.3.7 (можно обновить до 3.x, версия 4.x - major update)
- `@nuxtjs/supabase`: 1.5.0 → 1.6.2 (можно обновить, версия 2.0.1 - major update)
- `@supabase/supabase-js`: 2.49.8 → 2.81.1 (можно безопасно обновить)
- `nuxt`: 3.20.1 → 3.20.1 (текущая версия актуальна, 4.x - major update)
- Другие мелкие обновления

### 3. Отсутствие тестов
- В проекте нет тестов
- **Решение**: Добавить базовые тесты для критических endpoints

### 4. Упрощение JWT секретов
- Можно использовать один JWT_SECRET для обоих типов токенов (если не требуется дополнительная безопасность)
- Или оставить как есть для лучшей безопасности

### 5. Оптимизация импортов
- Проверить неиспользуемые зависимости
- Оптимизировать bundle size

## План действий

### Приоритет 1 (Критично)
1. ✅ Устранить дублирование кода (вынести generateTokens)
2. ✅ Обновить безопасные зависимости (@supabase/supabase-js, мелкие обновления)
3. ✅ Упростить JWT секреты (опционально - использовать один секрет)

### Приоритет 2 (Важно)
4. Обновить @nuxt/ui до 3.3.7 (minor update)
5. Обновить @nuxtjs/supabase до 1.6.2 (minor update)
6. Добавить базовые тесты для критических endpoints

### Приоритет 3 (Желательно)
7. Обновить до Nuxt 4.x (требует тестирования)
8. Обновить до @nuxt/ui 4.x (требует тестирования)
9. Обновить до @nuxtjs/supabase 2.x (требует тестирования)

## Рекомендации

1. **JWT_REFRESH_SECRET**: Можно использовать тот же JWT_SECRET, если не требуется дополнительная безопасность. Это упростит настройку.

2. **Обновления**: Начните с безопасных обновлений (patch/minor), затем протестируйте major обновления на отдельной ветке.

3. **Тесты**: Добавьте хотя бы базовые тесты для критических endpoints (auth, bookings).

4. **Рефакторинг**: Вынесите общие функции в утилиты для уменьшения дублирования.

