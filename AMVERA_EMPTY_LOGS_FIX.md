# Решение проблемы: пустые логи и контейнеры не запускаются

## Проблема

- Логи приложения пустые
- Контейнеры не могут запуститься
- Статус: "Работает с ошибками"

## Возможные причины

### 1. Контейнер падает сразу при запуске

Если логи пустые, значит контейнер падает до того, как успевает что-то записать.

**Возможные причины:**
- Файл `.output/server/index.mjs` не существует
- Проблема с правами доступа
- Отсутствуют необходимые зависимости
- Ошибка в команде запуска

### 2. Что я исправил

1. **Упростил Dockerfile:**
   - Временно убрал создание непривилегированного пользователя (может вызывать проблемы)
   - Добавил проверку файлов перед запуском
   - Упростил права доступа

2. **Проверка файлов:**
   - Добавлена команда проверки наличия `.output/server/index.mjs`
   - Это поможет увидеть ошибку, если файл отсутствует

## Что сделать сейчас

### Шаг 1: Закоммитьте изменения

```bash
git add Dockerfile
git commit -m "Упрощение Dockerfile для диагностики проблем запуска"
git push
```

### Шаг 2: Проверьте логи сборки

После push проверьте логи сборки - там должна быть проверка файлов:
- Если видите `ERROR: .output/server not found` - проблема в сборке
- Если видите `ERROR: index.mjs not found` - проблема в копировании файлов

### Шаг 3: Проверьте логи запуска

После пересборки проверьте логи запуска:
- Теперь должны появиться ошибки (если они есть)
- Или приложение должно запуститься

## Альтернативное решение: запуск от root

Если проблема в правах доступа, можно временно запускать от root:

```dockerfile
# Вместо USER nuxtjs - просто не переключаемся на пользователя
# Запускаем от root (временно для диагностики)
```

Но это уже сделано в текущем Dockerfile.

## Если все еще не работает

### Вариант 1: Проверьте, что файлы копируются

В логах сборки должна быть проверка:
```
ls -la .output/server/
```

Если файлов нет - проблема в сборке или копировании.

### Вариант 2: Упростите еще больше

Можно временно запускать без пользователя и с явной проверкой:

```dockerfile
# В конце Dockerfile
RUN echo "Checking files..." && \
    ls -la .output/server/ && \
    test -f .output/server/index.mjs && echo "File exists" || echo "File NOT found"

CMD ["sh", "-c", "echo 'Starting app...' && node .output/server/index.mjs"]
```

Это добавит больше диагностики в логи.

### Вариант 3: Обратитесь в поддержку Amvera

Если ничего не помогает:
1. Соберите логи сборки (полные)
2. Сделайте скриншот статуса приложения
3. Опишите проблему
4. Обратитесь: support@amvera.ru

## Проверка переменных окружения

Убедитесь, что в панели Amvera добавлены ВСЕ переменные:

```
SUPABASE_URL=...
SUPABASE_KEY=...
SUPABASE_SERVICE_KEY=...
JWT_SECRET=...
JWT_REFRESH_SECRET=...
TELEGRAM_BOT_TOKEN=...
TELEGRAM_WEBAPP_URL=...
TELEGRAM_ADMIN_CHAT_ID=...
NODE_ENV=production
DISABLE_REALTIME=false
```

**Важно:** Даже если переменные не используются при старте, их отсутствие может вызывать ошибки.

