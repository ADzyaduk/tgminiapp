# Решение проблем со сборкой в Amvera Cloud

## Частые проблемы и решения

### 1. Ошибка сборки - проверьте логи

**Важно:** Первым делом посмотрите логи сборки в панели Amvera:
1. Перейдите в панель управления приложением
2. Откройте вкладку **«Лог сборки»**
3. Нажмите **«Загрузить историю»**
4. Найдите ошибку в логах

### 2. Проблема: "Cannot find module" или ошибки зависимостей

**Решение:**
- Убедитесь, что `package.json` и `package-lock.json` находятся в корне репозитория
- Проверьте, что все зависимости указаны в `package.json`
- Попробуйте удалить `package-lock.json` и создать заново локально

### 3. Проблема: "Command failed" при сборке

**Возможные причины:**
- Недостаточно памяти на тарифе (попробуйте более высокий тариф)
- Ошибка в команде сборки
- Отсутствуют необходимые файлы

**Решение:**
- Проверьте, что команда `npm run build` работает локально
- Убедитесь, что все файлы закоммичены в Git (проверьте `.gitignore`)

### 4. Проблема: Nuxt не может найти конфигурацию

**Решение:**
- Убедитесь, что `nuxt.config.ts` находится в корне проекта
- Проверьте, что файл не игнорируется `.gitignore`

### 5. Проблема: Ошибка при запуске приложения

**Решение:**
- Проверьте, что команда `npm start` работает локально
- Убедитесь, что файл `.output/server/index.mjs` создается после сборки
- Проверьте переменные окружения в панели Amvera

## Альтернативные варианты конфигурации

### Вариант 1: Использовать только Dockerfile (без amvera.yaml)

Если `amvera.yaml` не работает, Amvera может использовать `Dockerfile`:

1. Удалите или переименуйте `amvera.yaml` (например, в `amvera.yaml.backup`)
2. Убедитесь, что `Dockerfile` находится в корне проекта
3. Amvera автоматически обнаружит `Dockerfile` и использует его

### Вариант 2: Упрощенный amvera.yaml

Если текущий `amvera.yaml` не работает, попробуйте упрощенную версию:

```yaml
version: 1

build:
  command: npm install && npm run build
  node: 18

run:
  command: npm start
  port: 3000
```

### Вариант 3: Без amvera.yaml (автоопределение)

Amvera может автоматически определить Nuxt приложение:
1. Удалите `amvera.yaml`
2. Убедитесь, что есть `package.json` с правильными скриптами
3. Amvera попытается автоматически определить тип приложения

## Проверка перед деплоем

Перед отправкой в Amvera убедитесь:

- [ ] `package.json` содержит скрипты `build` и `start`
- [ ] `nuxt.config.ts` находится в корне проекта
- [ ] Все необходимые файлы закоммичены (не в `.gitignore`)
- [ ] Локально работает `npm install && npm run build && npm start`
- [ ] Переменные окружения настроены в панели Amvera

## Тестирование локально

Перед деплоем протестируйте сборку локально:

```bash
# Очистка предыдущих сборок
rm -rf .output .nuxt node_modules

# Установка зависимостей
npm install

# Сборка
npm run build

# Проверка, что сборка успешна
ls -la .output/server/index.mjs

# Запуск (в другом терминале)
npm start
```

Если все работает локально, но не работает в Amvera - проверьте логи сборки.

## Полезные команды для диагностики

### Проверка структуры проекта

```bash
# Проверьте, что все важные файлы на месте
ls -la | grep -E "(package.json|nuxt.config|amvera.yaml|Dockerfile)"
```

### Проверка .gitignore

```bash
# Убедитесь, что важные файлы не игнорируются
cat .gitignore
```

### Проверка зависимостей

```bash
# Проверьте, что все зависимости установлены
npm list --depth=0
```

## Контакты поддержки

Если ничего не помогло:
1. Соберите логи сборки из панели Amvera
2. Опишите проблему
3. Обратитесь в поддержку Amvera: https://amvera.ru/support

