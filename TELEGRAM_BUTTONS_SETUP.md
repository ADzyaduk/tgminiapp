# üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ Telegram

–ë—ã—Å—Ç—Ä—ã–π –≥–∞–π–¥ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø—Ä—è–º–æ –≤ Telegram.

## üöÄ –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

- **–ú–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º** –ø—Ä—è–º–æ –≤ Telegram
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º** –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
- **–ù–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ –∞–¥–º–∏–Ω–∫—É** - –≤—Å–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ —á–∞—Ç–∞

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–û—Ç–∫—Ä–æ–π—Ç–µ `/admin/telegram-buttons` –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook

- **URL webhook –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω**
- –ù–∞–∂–º–∏—Ç–µ **"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Webhook"**
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å—Ç–∞—Ç—É—Å "ok": true

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É

- –í–≤–µ–¥–∏—Ç–µ –≤–∞—à **Telegram Chat ID** (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ)
- –í–≤–µ–¥–∏—Ç–µ **ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
- –ù–∞–∂–º–∏—Ç–µ **"–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"**

### 4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏

- –í Telegram –ø—Ä–∏–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
- –ù–∞–∂–º–∏—Ç–µ **"‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"** –∏–ª–∏ **"‚ùå –û—Ç–º–µ–Ω–∏—Ç—å"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–∏–ª—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üîç –ö–∞–∫ –Ω–∞–π—Ç–∏ –≤–∞—à Chat ID

### –°–ø–æ—Å–æ–± 1 - –ß–µ—Ä–µ–∑ getUpdates:

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ **–ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** –≤–∞—à–µ–º—É –±–æ—Ç—É –≤ Telegram
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
3. –ù–∞–π–¥–∏—Ç–µ `"chat":{"id": NUMBER}` –≤ –æ—Ç–≤–µ—Ç–µ - —ç—Ç–æ –≤–∞—à Chat ID

### –°–ø–æ—Å–æ–± 2 - –ß–µ—Ä–µ–∑ –±–æ—Ç–∞ @userinfobot:

1. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ `@userinfobot` –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É `/start`
3. –û–Ω –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à Chat ID

## üîß –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **API —Å–æ–∑–¥–∞–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. **–ú–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"/"–û—Ç–º–µ–Ω–∏—Ç—å"
3. **–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** –æ —Ç–æ–º —á—Ç–æ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞

### –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏:

1. **Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç callback** –Ω–∞ –≤–∞—à webhook endpoint
2. **–°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. **–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
4. **–°–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** –ø–æ–∫–∞–∑—ã–≤–∞—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–π—Å—Ç–≤–∏—è

## üì± Webhook endpoints

- **`POST /api/telegram/webhook`** - –æ—Å–Ω–æ–≤–Ω–æ–π webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–æ–∫
- **`POST /api/telegram/set-webhook`** - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook URL
- **`GET /api/telegram/webhook-info`** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook

## üéØ –§–æ—Ä–º–∞—Ç callback_data

–ö–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç:

- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:** `confirm_regular_<booking_id>`
- **–û—Ç–º–µ–Ω–∞:** `cancel_regular_<booking_id>`
- **–ì—Ä—É–ø–ø–æ–≤—ã–µ –ø–æ–µ–∑–¥–∫–∏:** `confirm_group_trip_<booking_id>`

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook:

```bash
curl http://localhost:3000/api/telegram/webhook-info
```

### –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:

```bash
curl -X POST http://localhost:3000/api/telegram/test-buttons \
  -H "Content-Type: application/json" \
  -d '{"chat_id": "YOUR_CHAT_ID", "booking_id": "test-123", "booking_type": "regular"}'
```

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook –≤—Ä—É—á–Ω—É—é:

```bash
curl -X POST http://localhost:3000/api/telegram/set-webhook \
  -H "Content-Type: application/json" \
  -d '{"webhook_url": "https://yourdomain.com/api/telegram/webhook"}'
```

## ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_ADMIN_CHAT_ID=your_admin_chat_id
```

### 2. HTTPS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

Telegram —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è webhook –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- **ngrok** –¥–ª—è —Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- **localhost** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞:

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º URL.

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫:

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `server/utils/telegram-notifications.ts`:

```typescript
{
  text: '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
  callback_data: `confirm_${bookingType}_${bookingId}`
},
{
  text: '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å',
  callback_data: `cancel_${bookingType}_${bookingId}`
}
```

### –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:

```typescript
{
  text: 'üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º',
  callback_data: `contact_${bookingType}_${bookingId}`
}
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

- **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏**
- **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–∏–ª—Å—è**
- **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**

–¢–µ–ø–µ—Ä—å –≤–∞—à–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ –ø—Ä—è–º–æ –∏–∑ Telegram! üöÄ
