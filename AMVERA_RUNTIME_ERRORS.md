# Решение ошибок при запуске в Amvera

## Сборка прошла успешно, но приложение работает с ошибками

Если сборка прошла успешно, но приложение показывает ошибки при запуске, проверьте следующее:

## 1. Проверьте логи запуска приложения

В панели Amvera:
1. Откройте ваше приложение
2. Перейдите в **«Логи приложения»** или **«Application Logs»** (НЕ логи сборки!)
3. Найдите ошибки при запуске

## 2. Частые проблемы

### Проблема: Отсутствуют переменные окружения

**Симптомы:**
- `Missing supabase url`
- `Missing supabase anon key`
- Ошибки при обращении к API

**Решение:**
Добавьте все переменные окружения в панели Amvera:
- `SUPABASE_URL`
- `SUPABASE_KEY`
- `SUPABASE_SERVICE_KEY`
- `JWT_SECRET`
- `JWT_REFRESH_SECRET`
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_WEBAPP_URL`
- `TELEGRAM_ADMIN_CHAT_ID`
- `NODE_ENV=production`
- `DISABLE_REALTIME=false`

### Проблема: Приложение не запускается

**Симптомы:**
- Health check не проходит
- Приложение недоступно по URL

**Решение:**
1. Проверьте логи запуска в Amvera
2. Убедитесь, что команда `npm start` работает (она должна запускать `node .output/server/index.mjs`)
3. Проверьте, что порт 3000 открыт

### Проблема: Ошибки с правами доступа

**Симптомы:**
- `Permission denied`
- `EACCES`

**Решение:**
Убедитесь, что файлы имеют правильные права доступа. В Dockerfile это уже настроено через `--chown=nuxtjs:nodejs`.

### Проблема: Ошибки с зависимостями

**Симптомы:**
- `Cannot find module`
- `Module not found`

**Решение:**
1. Убедитесь, что `package.json` и `package-lock.json` закоммичены
2. Проверьте, что все зависимости указаны в `dependencies` (не только в `devDependencies`)

## 3. Что проверить в логах запуска

Ищите в логах:
- ✅ `Server listening on port 3000` - приложение запустилось
- ❌ `Error: Cannot find module` - проблема с зависимостями
- ❌ `Missing environment variable` - не хватает переменных окружения
- ❌ `EADDRINUSE` - порт занят (маловероятно в Amvera)
- ❌ `Permission denied` - проблема с правами

## 4. Диагностика

### Проверка локально

Проверьте, что приложение запускается локально:

```bash
# Очистка
rm -rf node_modules .output

# Установка
npm install

# Сборка
npm run build

# Запуск
npm start
```

Если локально не работает - исправьте проблемы сначала.

### Проверка в Amvera

1. Откройте логи запуска приложения (не сборки!)
2. Найдите первую ошибку
3. Исправьте проблему
4. Перезапустите приложение в Amvera

## 5. Полезные команды для диагностики

Если у вас есть доступ к контейнеру:

```bash
# Проверка переменных окружения
env | grep -E "(SUPABASE|TELEGRAM|JWT)"

# Проверка файлов
ls -la .output/server/

# Проверка запуска
node .output/server/index.mjs
```

## 6. Контакты

Если ничего не помогает:
1. Соберите логи запуска из панели Amvera
2. Опишите проблему
3. Обратитесь в поддержку Amvera: support@amvera.ru

