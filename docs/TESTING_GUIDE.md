# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üéØ –°–ø–æ—Å–æ–±—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)**

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ development —Ä–µ–∂–∏–º:

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/telegram-auth` - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–µ–π–∫–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram.

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**

- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### 2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ ngrok (—Ä–µ–∞–ª—å–Ω—ã–π Telegram)**

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π Telegram Bot –∏ –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ.

#### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ngrok

```bash
# –°–∫–∞—á–∞–π—Ç–µ —Å https://ngrok.com/download
# –ò–ª–∏ —á–µ—Ä–µ–∑ npm
npm install -g ngrok

# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏ –ø–æ–ª—É—á–∏—Ç–µ authtoken
ngrok config add-authtoken YOUR_AUTHTOKEN
```

#### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è

```bash
# –í –ø–µ—Ä–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run dev

# –í–æ –≤—Ç–æ—Ä–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - —Å–æ–∑–¥–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å
ngrok http 3000
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ URL –≤–∏–¥–∞: `https://abc123.ngrok-free.app`

#### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Bot

1. –ù–∞–π–¥–∏—Ç–µ `@BotFather` –≤ Telegram
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –±–æ—Ç: `/newbot`
3. –ü–æ–ª—É—á–∏—Ç–µ Bot Token
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ WebApp:
   ```
   /setdomain
   –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω: abc123.ngrok-free.app
   ```
5. –°–æ–∑–¥–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É WebApp:
   ```
   /newwebapp
   –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   URL: https://abc123.ngrok-free.app/telegram-auth
   –ù–∞–∑–≤–∞–Ω–∏–µ: –¢–µ—Å—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–¥–æ–∫
   ```

#### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
TELEGRAM_BOT_TOKEN=your_real_bot_token_from_botfather
NODE_ENV=production  # –í–∫–ª—é—á–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é initData
```

#### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É WebApp
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TestAuthControls

–í –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É –Ω–∞ `/telegram-auth` –µ—Å—Ç—å –ø–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

### –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

- **üö™ –í—ã–π—Ç–∏ –∏–∑ Supabase** - –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ Supabase –∞–∫–∫–∞—É–Ω—Ç–∞
- **üîê –í—ã–π—Ç–∏ –∏–∑ Telegram Auth** - –æ—á–∏—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã
- **üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë** - —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ + –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
- **üéØ –¢–µ—Å—Ç Telegram Auth** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

- –°—Ç–∞—Ç—É—Å –æ–±–µ–∏—Ö —Å–∏—Å—Ç–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ù–∞–ª–∏—á–∏–µ initData
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ cookies
- –ü–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤ initData

## üîÑ –ü–æ—à–∞–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

1. **–û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ**: –ù–∞–∂–º–∏—Ç–µ "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë"
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å**: –î–æ–ª–∂–Ω–æ –±—ã—Ç—å "‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω" –≤–µ–∑–¥–µ
3. **–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**: –ù–∞–∂–º–∏—Ç–µ "üéØ –¢–µ—Å—Ç Telegram Auth"
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

1. **–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**: –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
2. **–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä**: +7 (999) 123-45-67
3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

1. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É**: F5
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ–ª–æ–≥–∏–Ω**: –î–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω—ã
3. **–ë–µ–∑ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö**: –ù–∏–∫–∞–∫–∏—Ö —Ñ–æ—Ä–º –≤–≤–æ–¥–∞ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

1. **–û—Ç–∫—Ä–æ–π—Ç–µ DevTools**: F12 ‚Üí Application ‚Üí Cookies
2. **–£–¥–∞–ª–∏—Ç–µ cookie**: `tg-access-token`
3. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É**: –î–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
4. **–£–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã**: `tg-refresh-token` —Ç–æ–∂–µ
5. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É**: –î–æ–ª–∂–µ–Ω –∑–∞–Ω–æ–≤–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è

## üö® –ß–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã

### 1. "initData not found"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ –≤ Telegram WebApp –∏–ª–∏ –Ω–µ—Ç ngrok
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ development —Ä–µ–∂–∏–º –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ ngrok

### 2. "Invalid initData signature"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π BOT_TOKEN –∏–ª–∏ –∏—Å—Ç—ë–∫ ngrok URL
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –¥–æ–º–µ–Ω –≤ BotFather

### 3. –¢–æ–∫–µ–Ω—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ JWT —Å–µ–∫—Ä–µ—Ç—ã
**–†–µ—à–µ–Ω–∏–µ**: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –∫–æ–º–∞–Ω–¥–æ–π:

```bash
node -e "console.log('JWT_SECRET=' + require('crypto').randomBytes(64).toString('hex'))"
```

### 4. "User not found in database"

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º—ã —Å Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SUPABASE_URL –∏ SUPABASE_KEY

## üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π:

- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–π Telegram Bot
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è initData —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ë–î
- ‚úÖ –ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Telegram WebApp –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://core.telegram.org/bots/webapps)
- [BotFather –∫–æ–º–∞–Ω–¥—ã](https://core.telegram.org/bots#3-how-do-i-create-a-bot)
- [ngrok –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://ngrok.com/docs)
- [JWT.io –æ—Ç–ª–∞–¥—á–∏–∫](https://jwt.io/)

## üí° –°–æ–≤–µ—Ç—ã

1. **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –ª–æ–∫–∞–ª—å–Ω–æ** —Å —Ñ–µ–π–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok** —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Bot Token** - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTTPS** - Telegram WebApp —Ç—Ä–µ–±—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
5. **–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏** –ø–æ–∫–∞–∂—É—Ç –≤—Å–µ —ç—Ç–∞–ø—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
