# Инструкция по настройке Supabase для проекта Boat Rental

## 1. Создание таблиц и функций в Supabase

Для настройки базы данных необходимо выполнить SQL-скрипт из файла `database/schema.sql`. Это можно сделать двумя способами:

### Вариант 1: Через веб-интерфейс Supabase

1. Зайдите в панель управления Supabase: https://app.supabase.com/
2. Выберите ваш проект
3. Перейдите в раздел "SQL Editor" (слева в меню)
4. Нажмите "New Query"
5. Скопируйте содержимое файла `database/schema.sql` в окно редактора
6. Нажмите "Run" для выполнения скрипта

### Вариант 2: Через CLI (если установлен)

```bash
supabase db push
```

## 2. Проверка созданных таблиц

После выполнения скрипта, проверьте наличие следующих таблиц в разделе "Table Editor":
- profiles
- boats
- bookings
- notifications
- reviews
- invites

## 3. Проверка созданных функций

Проверьте, что создана функция `get_rating_counts_for_boat`:
1. Перейдите в раздел "Database" -> "Functions"
2. Убедитесь, что функция `get_rating_counts_for_boat` присутствует

## 4. Настройка аутентификации (если необходимо)

1. Перейдите в раздел "Authentication" -> "Providers"
2. Настройте необходимые провайдеры аутентификации (Email, OAuth и т.д.)

## 5. CORS настройки (для работы с Telegram Mini App)

1. Перейдите в раздел "Settings" -> "API"
2. В разделе "CORS (Cross-Origin Resource Sharing)" добавьте следующие источники:
   - `https://telegram.org`
   - `https://telegram-web.app`
   - URL вашего приложения (где размещен фронтенд)

## 6. Получение и настройка переменных окружения

1. Перейдите в раздел "Settings" -> "API"
2. Скопируйте следующие значения:
   - URL (например, `https://xxxxxxxxxxxx.supabase.co`)
   - `anon` ключ (public)
   
3. Создайте или обновите файл `.env`:
```
SUPABASE_URL=https://xxxxxxxxxxxx.supabase.co
SUPABASE_KEY=your-anon-key
```

## 7. Тестирование соединения

После настройки проверьте соединение с базой данных через тестовую страницу в вашем приложении: `/test`

## Устранение неполадок

Если возникают ошибки запросов к базе данных:

1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что переменные окружения настроены правильно
3. Проверьте, что все таблицы и функции созданы (через веб-интерфейс Supabase)
4. Проверьте настройки Row Level Security (RLS) и политики доступа

## Специфика для Telegram Mini App

Для корректной работы Telegram Mini App важно:

1. Настроить CORS как указано выше
2. Убедиться, что ваш сервер отдает правильные заголовки
3. Использовать HTTPS
4. Проверить, что размер страницы не превышает лимиты Telegram 