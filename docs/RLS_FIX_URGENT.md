# üö® –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—à–∏–±–∫–∞ —Ä–µ–∫—É—Ä—Å–∏–∏ RLS

## –ü—Ä–æ–±–ª–µ–º–∞
```
infinite recursion detected in policy for relation "profiles"
```

## –ü—Ä–∏—á–∏–Ω–∞
–ü–æ–ª–∏—Ç–∏–∫–∏ RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `profiles` —Å–æ–∑–¥–∞—é—Ç —Ä–µ–∫—É—Ä—Å–∏—é, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –ø—ã—Ç–∞—é—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ç–æ–π –∂–µ —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤.

## ‚ö° –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase Dashboard ‚Üí SQL Editor:

```sql
-- –í–†–ï–ú–ï–ù–ù–û–ï –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï RLS (–¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫—É—Ä—Å–∏–∏)
ALTER TABLE public.profiles DISABLE ROW LEVEL SECURITY;

-- –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY IF EXISTS "Users can view own profile" ON public.profiles;
DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;
DROP POLICY IF EXISTS "Admins can view all profiles" ON public.profiles;
DROP POLICY IF EXISTS "Admins can update all profiles" ON public.profiles;

-- –í–∫–ª—é—á–∞–µ–º RLS –æ–±—Ä–∞—Ç–Ω–æ
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏
CREATE POLICY "Users can view own profile" ON public.profiles
  FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON public.profiles
  FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Enable insert for authenticated users" ON public.profiles
  FOR INSERT 
  WITH CHECK (auth.uid() = id);
```

### 2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –∫–æ–º–∞–Ω–¥ –≤—ã—à–µ, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É - –æ—à–∏–±–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å.

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –û—à–∏–±–∫–∞ `infinite recursion detected` –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
4. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–û—Ç–∫–ª—é—á–µ–Ω–∞ —Ä–µ–∫—É—Ä—Å–∏—è –≤ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö RLS**
2. **–î–æ–±–∞–≤–ª–µ–Ω fallback –≤ composable useAuth** - –µ—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–£–ø—Ä–æ—â–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - —É–±—Ä–∞–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤

## üîß –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –∫–æ–º–∞–Ω–¥ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è:

1. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä: `npm run dev`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí Authentication ‚Üí Policies —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã SQL –∫–æ–º–∞–Ω–¥—ã
- –ù–µ—Ç –ª–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–∏—Ç–∏–∫ –≤ Supabase Dashboard
- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ composable/useAuth.ts - —Ç–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –ø—Ä–æ—Ñ–∏–ª—è –≤ –ë–î 