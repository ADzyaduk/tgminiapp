# Финальное решение проблемы с переменными окружения

## Проблема

Модуль `@nuxtjs/supabase` не может найти переменные `SUPABASE_URL` и `SUPABASE_KEY` на клиентской стороне, даже если они добавлены в Amvera.

## Решение

### Вариант 1: Проверка переменных в Amvera (СНАЧАЛА ПРОВЕРЬТЕ ЭТО!)

1. **Убедитесь, что переменные добавлены правильно:**
   - Откройте панель Amvera → ваше приложение → **«Переменные окружения»**
   - Проверьте, что переменные называются **точно так**:
     - `SUPABASE_URL` (не `NUXT_SUPABASE_URL`, не `SUPABASE_URL_`)
     - `SUPABASE_KEY` (не `SUPABASE_ANON_KEY`, не `SUPABASE_KEY_`)
   - Убедитесь, что значения **не пустые** и скопированы полностью

2. **Перезапустите приложение:**
   - В панели Amvera нажмите **«Перезапустить»**
   - Подождите 30-60 секунд

3. **Проверьте логи:**
   - Откройте логи приложения в Amvera
   - Не должно быть ошибок `Missing supabase url` или `Missing supabase anon key`

### Вариант 2: Использование префикса NUXT_PUBLIC_ (если вариант 1 не помог)

Если переменные все еще не работают, попробуйте добавить переменные с префиксом `NUXT_PUBLIC_` в Amvera:

```
NUXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NUXT_PUBLIC_SUPABASE_KEY=your_anon_key_here
```

И обновите `nuxt.config.ts`:

```typescript
public: {
  supabaseUrl: process.env.NUXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL || '',
  supabaseAnonKey: process.env.NUXT_PUBLIC_SUPABASE_KEY || process.env.SUPABASE_KEY || '',
  ...
}
```

### Вариант 3: Явное указание в конфигурации Supabase

Если ничего не помогает, можно явно указать переменные в конфигурации Supabase через функцию:

```typescript
supabase: {
  url: () => process.env.SUPABASE_URL || '',
  key: () => process.env.SUPABASE_KEY || '',
  ...
}
```

Но это менее предпочтительно, так как модуль должен автоматически находить переменные.

## Диагностика

### Проверка переменных в контейнере

Если у вас есть доступ к контейнеру, можно проверить переменные:

```bash
# Проверка переменных окружения
env | grep SUPABASE
```

### Проверка в логах

Добавьте временную диагностику в код для проверки переменных:

```typescript
// В любом компоненте или плагине
const config = useRuntimeConfig()
console.log('Supabase URL:', config.public.supabaseUrl)
console.log('Supabase Key:', config.public.supabaseAnonKey ? '***' : 'NOT SET')
```

## Важные замечания

1. **Переменные должны быть добавлены ДО запуска приложения** - если вы добавили переменные после запуска, нужно перезапустить приложение
2. **Имена переменных чувствительны к регистру** - `SUPABASE_URL` и `supabase_url` - это разные переменные
3. **Пробелы в значениях** - убедитесь, что при копировании из Supabase Dashboard не добавились лишние пробелы

## Если ничего не помогает

1. Убедитесь, что в панели Amvera переменные добавлены в разделе **«Переменные окружения»** (не в другом месте)
2. Проверьте, что значения скопированы полностью из Supabase Dashboard
3. Перезапустите приложение вручную
4. Проверьте логи приложения на наличие других ошибок
5. Обратитесь в поддержку Amvera с логами приложения

